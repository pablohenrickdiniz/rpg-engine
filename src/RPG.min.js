(function(e){var g=e.CE,m=g.CE;var l={};var d=function(q){var p=this;m.call(p,q)};d.prototype=Object.create(m.prototype);d.constructor=d;d.prototype.drawMap=function(t){var q=this;var p=t.getAreaInterval({x:0,y:0,width:t.getFullWidth(),height:t.getFullHeight()});for(var s=p.si;s<=p.ei;s++){for(var r=p.sj;r<=p.ej;r++){if(t.tiles[s]!==undefined&&t.tiles[s][r]!==undefined){t.tiles[s][r].forEach(function(v,u){if(q.layers[u]!==undefined){if(v!==null){q.layers[u].clearRect({x:v.dx,y:v.dy,width:v.dWidth,height:v.dHeight});q.layers[u].image(v)}}})}}}};d.prototype.drawCharacter=function(p){};var o=function(q){var p=this;p.conditions=[];p.graphic=null;p.script=null;p.event=q};o.Conditions={LOCAL_SWITCH:1,GLOBAL_SWITH:2,VARIABLE:3};o.prototype.addCondition=function(r,q,s){var p=this;var u={type:r,name:q,value:s};p.conditions.push(u);var t=function(){p.event.activePage=p};switch(r){case o.Conditions.LOCAL_SWITCH:p.event.switchCallback(q,s,t);break;case o.Conditions.GLOBAL_SWITH:p.event.game.switchCallback(q,s,t);break;case o.Conditions.VARIABLE:break}};var k=function(B){var z=this;var q=B.pages;var s=B.position;var v=B.direction;var w=B.parent;var p=B.activePage;if(q instanceof Array){var A=q.length;for(var r=0;r<A;r++){if((q[r] instanceof o)){q.splice(r,1);r--}}}else{q=[]}if(s.constructor==={}.constructor){var u=parseFloat(s.x);var t=parseFloat(s.y);u=isNaN(u)?0:u;t=isNaN(t)?0:t;s.x=u;s.y=t}else{s={x:0,y:0}}w=w===undefined?null:w;p=p===undefined?0:p;z.pages=q;z.position=s;z.direction=k.DOWN;z.moving=false;z.switches=[];z.switchesCallbacks=[];z.game=null;z.activePage=null};k.prototype.enableSwitch=function(q){var p=this;p.switches[q]=true};k.prototype.disableSwitch=function(q){var p=this;p.switches[q]=false};k.prototype.switchCallback=function(r,p,t){var q=this;if(q.switchesCallbacks[r]===undefined){q.switchesCallbacks[r]=[]}var s=p?1:0;if(q.switchesCallbacks[r][s]===undefined){q.switchesCallbacks[r][s]=[]}q.switchesCallbacks[r][s].push(t)};k.prototype.addPage=function(q){var p=this;p.pages.push(q)};k.prototype.destroy=function(){};k.prototype.setGame=function(q){var p=this;p.game=q};var n={UP:0,LEFT:1,RIGHT:2,BOTTOM:4};var h=function(q){var p=this;p.graphic=null;p.speed=1};h.prototype.setGraphic=function(q){var p=this;p.graphic=q};h.prototype.stepUp=function(){var p=this;p.position.y-=p.speed};h.prototype.stepDown=function(){var p=this;p.position.y-=p.speed};h.prototype.stepLeft=function(){var p=this;p.position.x-=p.speed};h.prototype.stepRight=function(){var p=this;p.position.x+=p.speed};h.prototype.stepForward=function(){var p=this;switch(p.direction){case n.UP:p.stepUp();break;case n.LEFT:p.stepLeft();break;case n.RIGHT:p.stepRight();break;case n.DOWN:p.stepDown()}};var b=function(s){var r=this;var v=parseInt(s.width);var p=parseInt(s.height);var q=parseInt(s.tile_w);var u=parseInt(s.tile_h);var t=s.events;v=isNaN(v)?10:v;p=isNaN(p)?10:p;q=isNaN(q)?32:q;u=isNaN(u)?32:u;r.width=v;r.height=p;r.tile_w=q;r.tile_h=u;r.tiles=[];r.events=[];r.parent=null};b.prototype.getAreaInterval=function(A){var z=this;var v=parseInt(A.x);var u=parseInt(A.y);var p=parseInt(A.width);var w=parseInt(A.height);v=isNaN(v)?0:v;u=isNaN(u)?0:u;p=isNaN(p)?0:p;w=isNaN(w)?0:w;var t=parseInt(Math.floor(u/z.tile_h));var s=parseInt(Math.floor(v/z.tile_w));var r=parseInt(Math.floor((u+w)/z.tile_h));var q=parseInt(Math.floor((v+p)/z.tile_w));return{si:t,sj:s,ei:r,ej:q}};b.prototype.setTile=function(r,q,s){var p=this;if(p.tiles[r]===undefined){p.tiles[r]=[]}if(p.tiles[r][q]===undefined){p.tiles[r][q]=[]}p.tiles[r][q][s.layer]=s;return p};b.prototype.getTile=function(s,q,r){var p=this;if(p.tiles[s]!==undefined&&p.tiles[s][q]!==undefined&&p.tiles[s][q][r]!==undefined){return p.tiles[s][q][r]}return null};b.prototype.removeTile=function(s,q,r){var p=this;if(p.tiles[s]!==undefined&&p.tiles[s][q]!==undefined&&p.tiles[s][q][r]!==undefined){delete p.tiles[s][q][r]}};b.prototype.getFullWidth=function(){var p=this;return p.width*p.tile_w};b.prototype.getFullHeight=function(){var p=this;return p.height*p.tile_h};b.prototype.addEvent=function(q){var p=this;p.events.push(q)};b.prototype.eachTile=function(s){var p=this;for(var r=0;r<p.height;r++){for(var q=0;q<p.width;q++){if(p.tiles[r]!==undefined&&p.tiles[r][q]!==undefined){p.tiles[r][q].forEach(function(u,t){s(u,r,q,t)})}}}};var c=function(){var p=this;p.switches=[];p.switchesCallbacks=[];p.variables=[];p.currentMap=null;p.canvasEngine=null};c.prototype.initialize=function(){var q=this;if(q.canvasEngine!==null){q.canvasEngine.removeLayers(q.canvasEngine.layers);for(var r=0;r<10;r++){q.canvasEngine.createLayer()}var p=q.canvasEngine.getKeyReader();p.on(g.KeyReader)}};c.prototype.initializeMap=function(q){var p=this;p.canvasEngine.drawMap(q)};c.prototype.setCanvasEngine=function(q){var p=this;p.canvasEngine=q};c.prototype.enableSwitch=function(q){var p=this;p.switches[q]=true;if(p.switchesCallbacks[q]!==undefined&&p.switchesCallbacks[q][1]!==undefined){p.switchesCallbacks[q][1].forEach(function(r){r()})}};c.prototype.disableSwitch=function(q){var p=this;p.switches[q]=false;if(p.switchesCallbacks[q]!==undefined&&p.switchesCallbacks[q][0]!==undefined){p.switchesCallbacks[q][0].forEach(function(r){r()})}};c.prototype.switchCallback=function(r,p,s,u){var q=this;if(q.switchesCallbacks[r]===undefined){q.switchesCallbacks[r]=[]}var t=p?1:0;if(q.switchesCallbacks[r][t]===undefined){q.switchesCallbacks[r][t]=[]}q.switchesCallbacks[r][t].push(u)};c.prototype.save=function(){};c.prototype.pause=function(){};c.prototype.begin=function(){};c.prototype.end=function(){};var j=function(q,r){var p=this;p.width=10;p.height=10;p.x=0;p.y=0;p.parent=r};j.TOP_LEFT=0;j.TOP_CENTER=1;j.TOP_RIGHT=2;j.CENTER_LEFT=3;j.CENTER_CENTER=4;j.CENTER_RIGHT=5;j.BOTTOM_LEFT=6;j.BOTTOM_CENTER=7;j.BOTTOM_RIGHT=8;var i={loadedImages:[],loadAll:function(p,q){a(p,[],q)},load:function(s,t){var r=this;var p=document.createElement("a");p.href=s;s=$(p).prop("href");if(r.loadedImages[s]===undefined){var q=new Image();q.crossOrigin="Anonymous";q.src=s;q.onload=function(){r.loadedImages[s]=q;t(q)}}else{t(r.loadedImages[s])}},toDataURL:function(p,t){var q=document.createElement("canvas");var r=q.getContext("2d");q.width=p.width;q.height=p.height;r.drawImage(p,0,0);var s=q.toDataURL();t(s);q=null}};var a=function(p,r,s){r=r===undefined?[]:r;if(p.length>0){var q=p.shift();i.load(q,function(t){r.push(t);a(p,r,s)})}else{if(typeof s==="function"){s(r)}}};var f={fields:["image","dWidth","dHeight","sWidth","sHeight","sx","sy","dx","dy","layer"],load:function(u,v,w){var s=this;v=v===undefined||!(v instanceof b)?new b():v;var q=parseInt(u.tile_w);var t=parseInt(u.tile_h);q=isNaN(q)?32:q;t=isNaN(t)?32:t;v.tile_w=q;v.tile_h=t;var p=u.tilesets!==undefined?u.tilesets:[];var r=u.tiles!==undefined?u.tiles:[];i.loadAll(p,function(x){r.forEach(function(z,y){if(z!==null){z.forEach(function(A,B){if(A!==null){A.forEach(function(D,C){if(D!==null){var E={};s.fields.forEach(function(H,G){if(D[G]!==undefined){E[H]=D[G]}});if(E.image!==undefined){var F=E.image;if(x[F]!==undefined){E.image=x[F]}}v.setTile(y,B,E)}else{v.removeTile(y,B)}})}})}});w(v)})}};l.Direction=n;l.Character=h;l.CanvasEngine=d;l.Event=k;l.Page=o;l.Map=b;l.Game=c;l.MapLoader=f;e.RPG=l})(window);