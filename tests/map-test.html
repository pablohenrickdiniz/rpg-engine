<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Scene Map</title>
    <link rel="stylesheet" href="../src/css/rpg-engine.css"/>
    <link rel="stylesheet" href="../src/css/custom.css"/>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
</head>
<body onload="init()" style="padding:0;margin:0;overflow:hidden;">
<div id="game-content">
    <div id="container">

    </div>
    <div id="ui-root">

    </div>
</div>
<footer>
    <!-- Canvas Engine-->
    <script type="text/javascript" src="../plugins/canvas-engine/src/dist/js/CanvasEngine.js"></script>
    <script type="text/javascript" src="../plugins/canvas-engine/src/dist/js/CanvasLayer.js"></script>
    <script type="text/javascript" src="../plugins/Matter/build/matter.min.js"></script>
    <!-- Rpg Engine-->
    <script type="text/javascript" src="../plugins/math-lib/src/Math.js"></script>
    <script type="text/javascript" src="../plugins/Mouse/src/mouse.js"></script>
    <script type="text/javascript" src="../plugins/Keyboard/src/keyboard.js"></script>
    <script type="text/javascript" src="../src/AudioCompat.js"></script>
    <!--Main-->
    <script type="text/javascript" src="../src/System/Time/Timer_Ticker.js"></script>
    <script type="text/javascript" src="../src/RPG.js"></script>
    <!--Imports-->
    <script type="text/javascript" src="../src/Animation.js"></script>
    <!--Scene-->
    <script type="text/javascript" src="../src/Consts.js"></script>
    <script type="text/javascript" src="../src/System/Canvas.js"></script>
    <script type="text/javascript" src="../src/Scene/Scene.js"></script>
    <script type="text/javascript" src="../src/Game_Map.js"></script>
    <script type="text/javascript" src="../src/Game/Main.js"></script>
    <script type="text/javascript" src="../src/Graphics.js"></script>
    <script type="text/javascript" src="../src/Game_Graphic.js"></script>
    <script type="text/javascript" src="../src/Game_Animation.js"></script>
    <script type="text/javascript" src="../src/Tile.js"></script>
    <script type="text/javascript" src="../src/Animated_Tile.js"></script>
    <script type="text/javascript" src="../src/Spriteset_Map.js"></script>
    <script type="text/javascript" src="../src/Game_Object.js"></script>
    <script type="text/javascript" src="../src/Chara.js"></script>
    <script type="text/javascript" src="../src/Charas.js"></script>
    <script type="text/javascript" src="../src/Game_Face.js"></script>
    <script type="text/javascript" src="../src/Faces.js"></script>
    <script type="text/javascript" src="../src/Tileset.js"></script>
    <script type="text/javascript" src="../src/Tilesets.js"></script>
    <script type="text/javascript" src="../src/Game_Character.js"></script>
    <script type="text/javascript" src="../src/Event_Page.js"></script>
    <script type="text/javascript" src="../src/Game_Skill.js"></script>

    <!-- System-->
    <script type="text/javascript" src="../src/System/Audio/Audio_File.js"></script>
    <script type="text/javascript" src="../src/System/Audio/Audio.js"></script>
    <script type="text/javascript" src="../src/Game_Icon.js"></script>
    <script type="text/javascript" src="../src/Icons.js"></script>
    <script type="text/javascript" src="../src/Item.js"></script>
    <script type="text/javascript" src="../src/Items.js"></script>
    <script type="text/javascript" src="../src/Game_Slot.js"></script>
    <script type="text/javascript" src="../src/Game_Inventory.js"></script>
    <script type="text/javascript" src="../src/System/Events.js"></script>
    <script type="text/javascript" src="../src/Switches.js"></script>
    <script type="text/javascript" src="../src/Game_Event.js"></script>
    <script type="text/javascript" src="../src/Game_Item.js"></script>
    <script type="text/javascript" src="../src/Game_Actor.js"></script>
    <script type="text/javascript" src="../src/Scene/Scene_Map.js"></script>
    <script type="text/javascript" src="../src/Item_Graphic.js"></script>
    <script type="text/javascript" src="../src/Actors.js"></script>
    <script type="text/javascript" src="../src/Variables.js"></script>
    <script type="text/javascript" src="../src/Scenes.js"></script>
    <script type="text/javascript" src="../src/Maps.js"></script>
    <script type="text/javascript" src="../src/Animations.js"></script>
    <script type="text/javascript" src="../src/Skills.js"></script>

    <!-- Loader-->
    <script type="text/javascript" src="../src/Loader/Global_Progress.js"></script>
    <script type="text/javascript" src="../src/Loader/Graphic_Loader.js"></script>
    <script type="text/javascript" src="../src/Loader/Audio_Loader.js"></script>
    <script type="text/javascript" src="../src/Loader/Scene_Loader.js"></script>
    <script type="text/javascript" src="../src/Loader/Scene_Map_Loader.js"></script>
    <script type="text/javascript" src="../src/Loader/Tileset_Loader.js"></script>

    <!-- Scene-->
    <script type="text/javascript" src="../src/Scene/Scene_Manager.js"></script>

    <!-- UI-->
    <script type="text/javascript" src="../src/System/UI/UI.js"></script>
    <script type="text/javascript" src="../src/System/UI/Element.js"></script>
    <script type="text/javascript" src="../src/System/UI/Progress_Bar.js"></script>
    <script type="text/javascript" src="../src/System/UI/Image.js"></script>
    <script type="text/javascript" src="../src/System/UI/Text.js"></script>
    <script type="text/javascript" src="../src/System/UI/Player_Info.js"></script>
    <script type="text/javascript" src="../src/System/UI/Menu_Item.js"></script>
    <script type="text/javascript" src="../src/System/UI/Menu.js"></script>
    <script type="text/javascript" src="../src/System/UI/Button.js"></script>
    <script type="text/javascript" src="../src/System/UI/Window.js"></script>
    <script type="text/javascript" src="../src/System/UI/Slot.js"></script>
    <script type="text/javascript" src="../src/System/UI/Inventory.js"></script>
    <script type="text/javascript">
        function init() {
            window.RPG = false;
            let container = document.getElementById('container');
            let ui_root = document.getElementById('ui-root');

            RPG.initialize({
                container:container,
                ui_root:ui_root
            });

            RPG.debug = true;

            RPG.Scene_Manager.new('map','intro',{
                graphics:{
                    tilesets:{
                        forest2:'./Graphics/Tilesets/Town_Village-0034.png',
                        cavesAndUnderground:'./Graphics/Tilesets/Caves%20&%20Undergrounds%20-%200043.png'
                    },
                    charasets:{
                        char01:'./Graphics/Characters/Actor1.png',
                        male:'./Graphics/Characters/Las2vdS.png',
                        switch:'./Graphics/Characters/recolored-handle-switches-2.png',
                        lamp:'./Graphics/Characters/Object%20-%200905.png',
                        animal:'./Graphics/Characters/Animal.png'
                    },
                    faces:{
                        face01:'./Graphics/Faces/Actor1.png'
                    },
                    icons:{
                        icon01:'./Graphics/Icons/icons1.png'
                    }
                },
                audios:{
                    music:{
                        //      music1:'http://localhost/resources/Audio/Music%20OGG/Final%20Fantasy%20IX%20-%20Awakened%20Forest.ogg'
                    },
                    fx:{
                        //    inventory:'http://localhost/resources/Audio/Sound%20FX/Pack%20-%20Big%20Category%20Pack/COMMUN~1/SW46DE~1.ogg',
                        switch1:'./audio/fx/SWITCH_3.ogg',
                        switch2:'./audio/fx/SWITCH_4.ogg'
                    }
                },
                map:{
                    loop_x:false,
                    loop_y:false,
                    tilesets:[
                        {
                            graphicID:'forest2',
                            cols:8,
                            rows:149,
                            width:256,
                            height:4768
                        },
                        {
                            graphicID:'cavesAndUnderground',
                            cols:8,
                            rows:17,
                            width:256,
                            height:544
                        }
                    ],
                    spriteset:{
                        width:100,
                        height:100,
                        tileWidth:32,
                        tileHeight:32,
                        data:[]
                    }
                },
                objects:[
                    {
                        class:'Event',
                        x:250,
                        y:200,
                        pages:[
                            {
                                width:32,
                                height:32,
                                static:true,
                                charaID:'switch',
                                trigger:6,
                                script:function(){
                                    if(this.isSwitchDisabled('ON')){
                                        this.turnRight();
                                        this.playAudio('fx','switch2');
                                        this.enableSwitch('ON');
                                        this.enableGlobalSwitch('LAMP');
                                    }
                                    else{
                                        this.turnDown();
                                        this.playAudio('fx','switch1');
                                        this.disableSwitch('ON');
                                        this.disableGlobalSwitch('LAMP');
                                    }
                                }
                            }
                        ]
                    },
                    {
                        class:'Event',
                        x:122,
                        y:400,
                        pages:[
                            {
                                flashlightRadius:100,
                                width:32,
                                height:32,
                                charaID:'lamp',
                                trigger:4,
                                script:function(){
                                    this.turnLeft();
                                    this.flashlight = false;
                                }
                            },
                            {
                                flashlightRadius:500,
                                conditions:[
                                    'GLOBAL:LAMP:ON'
                                ],
                                width:32,
                                height:32,
                                charaID:'lamp',
                                trigger:4,
                                script:function(){
                                    this.turnDown();
                                    this.flashlight = true;
                                }
                            }
                        ]
                    },
//                    {
//                        class:'Event',
//                        x:300,
//                        y:300,
//                        pages:[
//                            {
//                                animationSpeed:10,
//                                width:32,
//                                height:32,
//                                charaID:'butterfly',
//                                flashlight:true,
//                                flashlightColor:'rgba(255,100,100,1)',
//                                through:true,
//                                script:function(){
//                                    this.step
//                                }
//                            }
//                        ]
//                    }
                ],
                charas:{
                    char1:{
                        graphicID:'char01',
                        rows:4,
                        cols:3,
                        sWidth:96,
                        sHeight:128
                    },
                    male1:{
                        graphicID:'male',
                        rows:4,
                        cols:9
                    },
                    switch:{
                        graphicID:'switch',
                        rows:4,
                        cols:3,
                        sWidth:96,
                        sHeight:128
                    },
                    lamp:{
                        graphicID:'lamp',
                        rows:4,
                        cols:4
                    },
                    butterfly:{
                        graphicID:'animal',
                        rows:4,
                        cols:3,
                        sx:288,
                        sy:128,
                        sWidth:96,
                        sHeight:128
                    }
                },
                faces:{
                    face01:{
                        graphicID:'face01',
                        sWidth:96,
                        sHeight:96
                    }
                },
                actors:{
                    1:{
                        x:300,
                        y:200,
                        charaID:'char1',
                        faceID:'face01',
                        vSpeed:0.001,
                        hSpeed:0.001,
                        animationSpeed:6,
                        startFrame:1,
                        type:'Player',
                        name:'Player 1',
                        inventory:{
                            slots: {
                                0: {max:99},
                                1: {max:99},
                                2: {max:99},
                                3: {max:99},
                                4: {max:99},
                                5: {max:99},
                                6: {max:99},
                                7: {max:99},
                                8: {max:99},
                                9: {max:99},
                                10: {max:99},
                                11: {max:99},
                                12: {max:99},
                                13: {max:99},
                                14: {max:99},
                                15: {max:99},
                                16: {max:99},
                                17: {max:99},
                                18: {max:99},
                                19: {max:99},
                                20: {max:99},
                                21: {max:99},
                                22: {max:99},
                                23: {max:99,item:0,amount:10},
                                armor:{
                                    max:1,
                                    type:'armor'
                                },
                                boots:{
                                    max:1,
                                    type:'boots'
                                },
                                pants:{
                                    max:1,
                                    type:'pants'
                                },
                                glooves:{
                                    max:1,
                                    type:'gloves'
                                },
                                elm:{
                                    max:1,
                                    type:'elm'
                                }
                            }
                        }
                    }
                },
                icons:{
                    icon01:{
                        graphicID:'icon01',
                        sx:24,
                        sy:48,
                        sWidth:24,
                        sHeight:24
                    },
                    apple:{
                        graphicID:'icon02',
                        sx:98,
                        sy:0,
                        sWidth:32,
                        sHeight:32
                    },
                    grape:{
                        graphicID:'icon02',
                        sx:0,
                        sy:0,
                        sWidth:32,
                        sHeight:32
                    },
                    armor:{
                        graphicID:'icon02',
                        sx:0,
                        sy:442,
                        sWidth:32,
                        sHeight:32
                    },
                    boots:{
                        graphicID:'icon02',
                        sx:0,
                        sy:480,
                        sWidth:33,
                        sHeight:32
                    },
                    elm:{
                        graphicID:'icon02',
                        sx:410,
                        sy:442,
                        sWidth:32,
                        sHeight:33
                    }
                },
                items:{
                    0:{
                        name:'sword1',
                        icon:'icon01'
                    },
                    1:{
                        name:'apple',
                        icon:'apple'
                    },
                    2:{
                        name:'grape',
                        icon:'grape'
                    },
                    3:{
                        name:'armor',
                        icon:'armor',
                        type:'armor'
                    },
                    4:{
                        name:'elm',
                        icon:'elm',
                        type:'elm'
                    },
                    5:{
                        name:'boots',
                        icon:'boots',
                        type:'boots'
                    }
                },
                beforeload:function(root){
                    let UI = root.UI;
                    let ui = root.UI.root;

                    ui.add(new UI.Progress_Bar({
                        id:'loading-progress'
                    }));
                    ui.add(new UI.Player_Info({
                        id:'player-info',
                        visible:false
                    }));
                    ui.add(new UI.Inventory({
                        id:'inventory',
                        class:'window inventory',
                        width:200,
                        height:323,
                        visible:false,
                        draggable:true,
                        left:300,
                        top:300
                    }));
                    ui.add(new UI.Text({
                        id:'fps',
                        width:100,
                        height:30,
                        visible:true,
                        class:'fps',
                        value:20
                    }));
                },
                afterload:function(root){
                    root.UI.root.findById('loading-progress').visible = false;
                    let spriteset = root.Main.currentScene.spriteset;
                    let i;
                    let j;
                    for(i =0; i < spriteset.height;i++){
                        for(j = 0; j < spriteset.width;j++){
                            spriteset.set(i,j,0,['forest2',0,0]);
                        }
                    }

                    root.Main.currentPlayerID = 1;
                },
                start:function(root){
                    if(root.Main.currentPlayer){
                        let info = root.UI.root.findById('player-info');
                        info.face = root.Main.currentPlayer.face;
                        info.totalMP = 500;
                        info.MP = 400;
                        info.name = root.Main.currentPlayer.name;
                        info.visible = true;
                        root.UI.root.findById('inventory').inventory = root.Main.currentPlayer.inventory;
                        root.UI.root.findById('fps').visible = true;
                    }

                    root.Controls.Keyboard.addShortcutListener('i', function () {
                        let inventory_ui = root.UI.root.findById('inventory');
                        inventory_ui.visible = !inventory_ui.visible;
                    });

                    root.Main.currentScene.focus(root.Main.currentPlayer);

                },
                progress:function(progress){
                    let progress_bar = RPG.UI.root.findById('loading-progress');

                    if(progress_bar != null){
                        progress_bar.progress = progress;
                    }
                }
            });

            RPG.Scene_Manager.call('intro');
        }
    </script>
</footer>
</body>
</html>