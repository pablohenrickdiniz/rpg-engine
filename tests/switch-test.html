<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Switch Test</title>
    <!-- canvas engine-->
    <script type="text/javascript" src="../plugins/canvas-engine/src/dist/js/CanvasEngine.js"></script>
    <script type="text/javascript" src="../plugins/canvas-engine/src/dist/js/CanvasLayer.js"></script>

    <!-- rpg engine-->
    <script type="text/javascript" src="../plugins/math-lib/src/Math.js"></script>
    <script type="text/javascript" src="../plugins/Mouse/src/mouse.js"></script>
    <script type="text/javascript" src="../plugins/Keyboard/src/keyboard.js"></script>
    <script type="text/javascript" src="../plugins/quadtree/src/quad-tree.js"></script>
    <script type="text/javascript" src="../src/AudioCompat.js"></script>


    <!--Main-->
    <script type="text/javascript" src="../src/System/TimerTicker.js"></script>
    <script type="text/javascript" src="../src/RPG.js"></script>
    <script type="text/javascript" src="../src/Game/Main.js"></script>


    <!-- Resources-->
    <script type="text/javascript" src="../src/Resources/Graphics.js"></script>


    <!--Imports-->
    <script type="text/javascript" src="../src/Animation.js"></script>
    <script type="text/javascript" src="../src/Frame.js"></script>
    <script type="text/javascript" src="../src/AnimatedTile.js"></script>
    <script type="text/javascript" src="../src/Game_Map.js"></script>
    <script type="text/javascript" src="../src/Tileset.js"></script>
    <script type="text/javascript" src="../src/Consts.js"></script>
    <script type="text/javascript" src="../src/Character_Graphic.js"></script>
    <script type="text/javascript" src="../src/Game_Character.js"></script>
    <script type="text/javascript" src="../src/Game_Player.js"></script>
    <script type="text/javascript" src="../src/Event_Page.js"></script>
    <script type="text/javascript" src="../src/Game_Event.js"></script>
    <script type="text/javascript" src="../src/SpritesetMap.js"></script>


    <!-- System-->
    <script type="text/javascript" src="../src/System/Canvas.js"></script>
    <script type="text/javascript" src="../src/System/Audio.js"></script>

    <!--Scene-->
    <script type="text/javascript" src="../src/Scene/Scene.js"></script>
    <script type="text/javascript" src="../src/Scene/SceneMap.js"></script>


    <!-- Loader-->
    <script type="text/javascript" src="../src/Loader/GlobalProgress.js"></script>
    <script type="text/javascript" src="../src/Loader/ImageLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/AudioLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/SceneLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/SceneMapLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/TilesetLoader.js"></script>

    <!-- Scene-->
    <script type="text/javascript" src="../src/Scene/SceneManager.js"></script>
    <script type="text/javascript" src="../src/Scene/Scene.js"></script>


    <!--data -->
    <script type="text/javascript" src="../src/Characters.js"></script>
    <script type="text/javascript" src="dat/game_data.js"></script>

    <script type="text/javascript">
        function init() {
            var container = document.getElementById('container');
            var Game_Player = RPG.Game_Player,
                    Character_Graphic = RPG.Character_Graphic,
                    Game_Event = RPG.Game_Event,
                    Event_Page = RPG.Event_Page;

            var player = new Game_Player({
                graphic: new Character_Graphic({
                    image: '1',
                    rows: 4,
                    cols: 9
                }),
                speed: 8
            });

            RPG.initialize({
                container: container,
                player: player
            });

            RPG.SceneManager.new('Map', 'map01', {
                map: {
                    tileWidth: 32,
                    tileHeight: 32,
                    spriteset: spriteset,
                    player: {
                        x: 100,
                        y: 100
                    }
                },
                graphics: {
                    characters: {
                        '1': '../src/images/Las2vdS.png',
                        '2': '../src/images/mack_char01.png',
                        'switches':'../src/images/recolored-handle-switches-2.png'
                    },
                    tilesets: {
                        '1': '../src/images/tilea2.png'
                    }
                },
                start: function () {
                    var Consts = RPG.Consts;
                    console.log('started...');
                    var character1 = RPG.Characters.get('character1');
                    var self = this;
                    self.map_data.map.add(character1);
                    var page1 = new Event_Page({
                          graphic:new Character_Graphic({
                              image:'switches',
                              rows:4,
                              cols:3,
                              sWidth:96,
                              sHeight:128
                          }),
                          script:function(){
                              if(this.isEnabled('A')){
                                  this.look(Consts.CHARACTER_DIRECTION_DOWN);
                                  this.disableSwitch('A');
                                  this.through = false;
                              }
                              else{
                                  this.look(Consts.CHARACTER_DIRECTION_RIGHT);
                                  this.enableSwitch('A');
                                  this.through = true;
                              }
                          },
                           trigger:  Consts.TRIGGER_ACTION_BUTTON
                    });


                    var eventSwitch = new Game_Event({
                        x:150,
                        y:100,
                        pages:[page1]
                    });
                    self.map_data.map.add(eventSwitch);
                }
            });
            RPG.SceneManager.call('map01');
        }
    </script>
</head>
<body onload="init()">
<div id="container"></div>
</body>
</html>