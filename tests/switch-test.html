<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch Test</title>
    <!-- canvas engine-->
    <script type="text/javascript" src="../plugins/canvas-engine/src/dist/js/CanvasEngine.js"></script>
    <script type="text/javascript" src="../plugins/canvas-engine/src/dist/js/CanvasLayer.js"></script>

    <!-- rpg engine-->
    <script type="text/javascript" src="../plugins/math-lib/src/Math.js"></script>
    <script type="text/javascript" src="../plugins/Mouse/src/mouse.js"></script>
    <script type="text/javascript" src="../plugins/Keyboard/src/keyboard.js"></script>
    <script type="text/javascript" src="../plugins/quadtree/src/quad-tree.js"></script>
    <script type="text/javascript" src="../src/AudioCompat.js"></script>


    <!--Main-->
    <script type="text/javascript" src="../src/System/TimerTicker.js"></script>
    <script type="text/javascript" src="../src/RPG.js"></script>
    <script type="text/javascript" src="../src/Game/Main.js"></script>


    <!-- Resources-->
    <script type="text/javascript" src="../src/Resources/Graphics.js"></script>


    <!--Imports-->
    <script type="text/javascript" src="../src/Animation.js"></script>
    <script type="text/javascript" src="../src/Frame.js"></script>
    <script type="text/javascript" src="../src/AnimatedTile.js"></script>
    <script type="text/javascript" src="../src/Game_Map.js"></script>
    <script type="text/javascript" src="../src/Tileset.js"></script>
    <script type="text/javascript" src="../src/Consts.js"></script>
    <script type="text/javascript" src="../src/Graphic.js"></script>
    <script type="text/javascript" src="../src/Character_Graphic.js"></script>
    <script type="text/javascript" src="../src/Game_Object.js"></script>
    <script type="text/javascript" src="../src/Game_Character.js"></script>
    <script type="text/javascript" src="../src/Game_Actor.js"></script>
    <script type="text/javascript" src="../src/Game_Player.js"></script>
    <script type="text/javascript" src="../src/Event_Page.js"></script>
    <script type="text/javascript" src="../src/Game_Event.js"></script>
    <script type="text/javascript" src="../src/Game_Item.js"></script>
    <script type="text/javascript" src="../src/Item_Graphic.js"></script>
    <script type="text/javascript" src="../src/SpritesetMap.js"></script>


    <!-- System-->
    <script type="text/javascript" src="../src/System/Canvas.js"></script>
    <script type="text/javascript" src="../src/System/Audio.js"></script>

    <!--Scene-->
    <script type="text/javascript" src="../src/Scene/Scene.js"></script>
    <script type="text/javascript" src="../src/Scene/SceneMap.js"></script>


    <!-- Loader-->
    <script type="text/javascript" src="../src/Loader/GlobalProgress.js"></script>
    <script type="text/javascript" src="../src/Loader/ImageLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/AudioLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/SceneLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/SceneMapLoader.js"></script>
    <script type="text/javascript" src="../src/Loader/TilesetLoader.js"></script>

    <!-- Scene-->
    <script type="text/javascript" src="../src/Scene/SceneManager.js"></script>
    <script type="text/javascript" src="../src/Scene/Scene.js"></script>


    <!--data -->
    <script type="text/javascript" src="../src/Resources/Characters.js"></script>
    <script type="text/javascript" src="../src/Resources/Items.js"></script>
    <script type="text/javascript" src="dat/game_data.js"></script>
    <script type="text/javascript" src="../src/Global_Switches.js"></script>

    <script type="text/javascript">
        function init() {


            var container = document.getElementById('container');
            var Game_Player = RPG.Game_Player,
                    Character_Graphic = RPG.Character_Graphic,
                    Game_Event = RPG.Game_Event,
                    Characters = RPG.Characters;

            var player = new Game_Player({
                graphic: new Character_Graphic({
                    image: '1',
                    rows: 4,
                    cols: 9
                }),
                speed: 8
            });

            RPG.initialize({
                container: container,
                player: player
            });

            RPG.SceneManager.new('Map', 'map01', {
                map: {
                    tileWidth: 32,
                    tileHeight: 32,
                    spriteset: spriteset,
                    player: {
                        x: 100,
                        y: 100
                    }
                },
                graphics: {
                    character: {
                        '1': '../src/images/Las2vdS.png',
                        '2': '../src/images/mack_char01.png',
                        'switches':'../src/images/recolored-handle-switches-2.png'
                    },
                    tileset: {
                        '1': '../src/images/Town & Village - 0034.png'
                    },
                    icon:{
                        '1':'../src/images/icons1.png'
                    }
                },
                start: function () {
                    console.log('started...');
                    var Consts = RPG.Consts;
                    var character1 = RPG.Characters.createInstance('character1');
                    var self = this;
                    self.map.add(character1);

                    var event1 = new Game_Event({
                        x:150,
                        y:100
                    });

                    event1.newPage({
                        graphic:new Character_Graphic({
                            image:'switches',
                            rows:4,
                            cols:3,
                            sWidth:96,
                            sHeight:128
                        }),
                        script:function(){
                            var global = RPG.GlobalSwitches;
                            if(!global.isEnabled('A')){
                                global.enable('A');
                                this.turnRight();
                            }
                            else{
                                global.disable('A');
                                this.turnDown();
                            }
                        },
                        trigger:  Consts.TRIGGER_ACTION_BUTTON
                    });

                    var event2 = new Game_Event({
                        x:200,
                        y:200
                    });

                    event2.newPage({
                        graphic:new Character_Graphic({
                            image:'switches',
                            rows:4,
                            cols:3,
                            sWidth:96,
                            sHeight:128
                        }),
                        conditions:[
                            'GLOBAL:A:ON',
                            'GLOBAL:B:ON'
                        ]
                    });


                    var event3 = new Game_Event({
                        x:200,
                        y:100
                    });

                    event3.newPage({
                        graphic:new Character_Graphic({
                            image:'switches',
                            rows:4,
                            cols:3,
                            sWidth:96,
                            sHeight:128
                        }),
                        script:function(){
                            var global = RPG.GlobalSwitches;
                            if(!global.isEnabled('B')){
                                global.enable('B');
                                this.turnRight();
                            }
                            else{
                                global.disable('B');
                                this.turnDown();
                            }
                        },
                        trigger:  Consts.TRIGGER_ACTION_BUTTON
                    });

                    self.map.add(event1);
                    self.map.add(event2);
                    self.map.add(event3);
                    var chars = [];

                    for(var i =0; i < 2;i++){
                        var x = Math.floor(Math.random()*1000);
                        var y = Math.floor(Math.random()*1000);
                        var character = Characters.createInstance('character1',{
                            x:x,
                            y:y
                        });
                        self.map.add(character);
                        chars.push(character);
                    }

                    setInterval(function(){
                        chars.forEach(function(char){
                            char.stepRandom(10);
                        });
                    },3000);
                }
            });
            RPG.SceneManager.call('map01');
        }
    </script>
</head>
<body onload="init()" id="container" style="height:600px;">

</body>
</html>